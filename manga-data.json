import json

def fix_manga_structure(input_data):
    # แปลง JSON เป็น dictionary
    try:
        data = json.loads(input_data)
    except json.JSONDecodeError as e:
        print(f"ข้อผิดพลาดในการอ่าน JSON: {e}")
        return None
    
    # ตรวจสอบโครงสร้างและแก้ไข
    if "manga" not in data:
        print("ไม่พบ key 'manga' ใน JSON")
        return None
    
    fixed_manga = []
    
    for item in data["manga"]:
        # ถ้าเป็น manga ใหม่
        if "id" in item:
            # สร้าง manga ใหม่
            manga = {
                "id": item["id"],
                "title": item["title"],
                "description": item["description"],
                "cover": item["cover"],
                "chapters": item.get("chapters", [])
            }
            fixed_manga.append(manga)
        # ถ้าเป็น chapter ที่หลุดมา
        elif "number" in item and fixed_manga:
            # เพิ่ม chapter เข้าไปใน manga ล่าสุด
            fixed_manga[-1]["chapters"].append(item)
    
    # สร้างโครงสร้างใหม่ที่ถูกต้อง
    fixed_data = {"manga": fixed_manga}
    
    return json.dumps(fixed_data, indent=4, ensure_ascii=False)

# JSON ต้นฉบับที่มีปัญหา
input_json = """
{
    "manga": [
        {
            "id": 1,
            "title": "Fight​ Class​ 3",
            "description": "เรื่องราวการผจญภัยของลูฟี่และลูกเรือโจรสลัดหมวกฟาง",
            "cover": "https://i.postimg.cc/zvrb35Nx/images-3.jpg",
            "chapters": [
                {
                    "number": 1,
                    "title": "ยกที่1",
                    "pages": [
                        "https://img5.pic.in.th/file/secure-sv1/1000037499.jpeg",
                        "https://img2.pic.in.th/pic/1000037498586483c98c1d6756.png",
                        "https://img2.pic.in.th/pic/10000374974557e88296b3e46d.jpg",
                        "https://img2.pic.in.th/pic/1000037496.jpeg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037495.jpeg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037494.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037493.jpeg",
                        "https://img5.pic.in.th/file/secure-sv1/100003749225b9cd59b4869833.jpeg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037491.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037490.jpeg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037487.png",
                        "https://img2.pic.in.th/pic/1000037488.png",
                        "https://img2.pic.in.th/pic/1000037489.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037486.png",
                        "https://img2.pic.in.th/pic/1000037485.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037484.png",
                        "https://img2.pic.in.th/pic/1000037483.png",
                        "https://img2.pic.in.th/pic/1000037482.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037481.png",
                        "https://img2.pic.in.th/pic/1000037480.png",
                        "https://img2.pic.in.th/pic/1000037479.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037478.png",
                        "https://img2.pic.in.th/pic/1000037477.png",
                        "https://img2.pic.in.th/pic/1000037476486355b2ca868d96.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037475.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037474.png",
                        "https://img2.pic.in.th/pic/1000037473.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037472.png",
                        "https://img2.pic.in.th/pic/1000037471.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037470.png"
                    ]
                },
                {
                    "number": 2,
                    "title": "ยกที่2",
                    "pages": [
                        "https://img5.pic.in.th/file/secure-sv1/1000037549.png",
                        "https://img2.pic.in.th/pic/1000037548.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037547.png",
                        "https://img2.pic.in.th/pic/1000037546.png",
                        "https://img2.pic.in.th/pic/1000037545.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037544.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037543.png",
                        "https://img2.pic.in.th/pic/1000037542.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037541.png",
                        "https://img2.pic.in.th/pic/1000037540.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037539.png",
                        "https://img2.pic.in.th/pic/1000037538.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037537.png",
                        "https://img2.pic.in.th/pic/1000037536.png",
                        "https://img2.pic.in.th/pic/1000037535.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037534.png",
                        "https://img2.pic.in.th/pic/1000037533.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037532.png",
                        "https://img2.pic.in.th/pic/1000037531.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037530.png",
                        "https://img2.pic.in.th/pic/1000037529.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037528.png",
                        "https://img2.pic.in.th/pic/1000037527.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037526.png",
                        "https://img2.pic.in.th/pic/1000037525.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037524.png",
                        "https://img2.pic.in.th/pic/1000037523.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037522.png",
                        "https://img2.pic.in.th/pic/1000037521.png",
                        "https://img5.pic.in.th/file/secure-sv1/1000037520.png"
                    ]
                },
                {
                    "number": 3,
                    "title": "ยกที่3",
                    "pages": [
                        "https://img5.pic.in.th/file/secure-sv1/1000037577.jpg",
                        "https://img2.pic.in.th/pic/1000037576.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037575.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037574.jpg",
                        "https://img2.pic.in.th/pic/1000037573.jpg",
                        "https://img2.pic.in.th/pic/1000037572.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037571.jpg",
                        "https://img2.pic.in.th/pic/1000037570.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037569.jpg",
                        "https://img2.pic.in.th/pic/1000037568.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037567.jpg",
                        "https://img2.pic.in.th/pic/1000037566.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037565.jpg",
                        "https://img2.pic.in.th/pic/1000037564.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037563.jpg",
                        "https://img2.pic.in.th/pic/1000037562.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037561.jpg",
                        "https://img2.pic.in.th/pic/1000037560.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037559.jpg",
                        "https://img2.pic.in.th/pic/1000037558.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037557.jpg",
                        "https://img2.pic.in.th/pic/1000037556.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037555.jpg",
                        "https://img2.pic.in.th/pic/10000375548b122fa5202d7eaf.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037553.jpg"
                    ]
                },
                {
                    "number": 4,
                    "title": "ยกที่4",
                    "pages": [
                        "https://img2.pic.in.th/pic/1000037624.jpg",
                        "https://img2.pic.in.th/pic/1000037623.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037622.jpg",
                        "https://img2.pic.in.th/pic/1000037621.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037620.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037619.jpg",
                        "https://img2.pic.in.th/pic/1000037618.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037617.jpg",
                        "https://img2.pic.in.th/pic/1000037616.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037615.jpg",
                        "https://img2.pic.in.th/pic/1000037614.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037613.jpg",
                        "https://img2.pic.in.th/pic/1000037612.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037611.jpg",
                        "https://img2.pic.in.th/pic/1000037610.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037609.jpg",
                        "https://img2.pic.in.th/pic/1000037608.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037607.jpg",
                        "https://img2.pic.in.th/pic/1000037606.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037605.jpg",
                        "https://img2.pic.in.th/pic/1000037604.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037603.jpg",
                        "https://img2.pic.in.th/pic/1000037602.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037601.jpg",
                        "https://img2.pic.in.th/pic/1000037600.jpg",
                        "https://img5.pic.in.th/file/secure-sv1/1000037599.jpg"
                    ]
                }
            ]
        },
        {
            "id": 2,
            "title": "test",
            "description": "test",
            "cover": "https://example.com/solo-leveling-cover.jpg",
            "chapters": [
                {
                    "number": 179,
                    "title": "test",
                    "pages": [
                        "https://example.com/solo-leveling-179-1.jpg",
                        "https://example.com/solo-leveling-179-2.jpg"
                    ]
                }
            ]
        }
    ]
}
"""

# แก้ไข JSON
fixed_json = fix_manga_structure(input_json)

if fixed_json:
    print("ผลลัพธ์หลังจากแก้ไข:")
    print(fixed_json)
    
    # บันทึกเป็นไฟล์ (ถ้าต้องการ)
    with open('fixed_manga.json', 'w', encoding='utf-8') as f:
        f.write(fixed_json)
    print("\nบันทึกไฟล์สำเร็จเป็น fixed_manga.json")
else:
    print("ไม่สามารถแก้ไขไฟล์ JSON ได้")
